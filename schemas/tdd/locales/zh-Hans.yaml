schema:
  description: 测试驱动开发工作流程 - tests → implementation → docs

artifacts:
  spec:
    description: 定义需求的功能规范
    instruction: |
      创建定义要构建什么的功能规范。

      章节：
      - **Feature**：功能名称和高级描述，说明其目的和用户价值
      - **Requirements**：具体需求列表。对规范性语言使用 SHALL/MUST。
      - **Acceptance Criteria**：使用 WHEN/THEN 格式的可测试标准

      格式化要求：
      - 每个要求应该是具体和可测试的
      - 对验收标准使用 `#### Scenario: <name>` 和 WHEN/THEN 格式
      - 明确定义边缘情况和错误场景
      - 每个要求必须至少有一个场景

      示例：
      ```
      ## Feature: 用户认证

      用户可以安全地登录应用程序。

      ## Requirements

      ### Requirement: 密码验证
      系统必须验证密码符合最低安全要求。

      #### Scenario: 接受有效密码
      - **WHEN** 密码有 8 个以上字符、大写、小写和数字
      - **THEN** 密码被接受

      #### Scenario: 拒绝弱密码
      - **WHEN** 密码少于 8 个字符
      - **THEN** 系统显示"密码太短"错误
      ```

      此规范驱动测试创建 - 每个场景都成为一个测试用例。

  tests:
    description: 在实施之前编写的测试文件
    instruction: |
      在实施之前编写测试（TDD 红色阶段）。

      文件命名：
      - 创建测试文件为 `tests/<feature>.test.ts`
      - 每个功能/能力一个测试文件
      - 使用与规范匹配的描述性名称

      测试结构：
      - 使用与规范场景匹配的 Given/When/Then 格式
      - 使用 `describe()` 块对相关测试进行分组
      - 规范中的每个场景至少成为一个 `it()` 测试

      覆盖要求：
      - 覆盖规范中的每个要求
      - 包括快乐路径（成功案例）
      - 包括边缘情况（边界条件）
      - 包括错误场景（无效输入、失败）
      - 测试最初应该失败（尚未实施）

      示例：
      ```typescript
      describe('密码验证', () => {
        it('接受符合所有要求的有效密码', () => {
          // GIVEN 一个符合所有要求的密码
          const password = 'SecurePass1';
          // WHEN 验证
          const result = validatePassword(password);
          // THEN 应该被接受
          expect(result.valid).toBe(true);
        });

        it('拒绝少于 8 个字符的密码', () => {
          // GIVEN 一个短密码
          const password = 'Short1';
          // WHEN 验证
          const result = validatePassword(password);
          // THEN 应该被拒绝并显示消息
          expect(result.valid).toBe(false);
          expect(result.error).toBe('密码太短');
        });
      });
      ```

      完全遵循规范要求 - 测试验证规范。

  implementation:
    description: 使测试通过的实施代码
    instruction: |
      实施功能以使测试通过（TDD 绿色阶段）。

      TDD 工作流程：
      1. 运行测试 - 确认它们失败（红色）
      2. 编写最小代码以通过一个测试
      3. 运行测试 - 确认该测试通过（绿色）
      4. 如需要，在保持测试绿色时进行重构
      5. 为下一个失败的测试重复

      实施指南：
      - 编写最小代码以通过每个测试 - 不多不少
      - 频繁运行测试以验证进度
      - 保持功能小而专注
      - 使用清晰、描述性的名称

      代码组织：
      - 在 `src/<feature>.ts` 中创建源文件
      - 清楚地导出公共 API
      - 保留实施细节为私有
      - 为公共函数添加 JSDoc 注释

      示例结构：
      ```typescript
      /**
       * 验证密码符合安全要求。
       * @param password - 要验证的密码
       * @returns 带有 valid 标志和可选错误的验证结果
       */
      export function validatePassword(password: string): ValidationResult {
        if (password.length < 8) {
          return { valid: false, error: '密码太短' };
        }
        // ... 其他检查
        return { valid: true };
      }
      ```

      不要过度设计 - 仅实施测试所需的内容。

  docs:
    description: 已实施功能的文档
    instruction: |
      记录已实施的功能。

      章节：
      - **Overview**：功能的作用及其存在原因（1-2 段）
      - **Getting Started**：立即使用功能的快速入门指南
      - **Examples**：显示常见用例的代码示例
      - **Reference**：详细的 API 文档、配置选项

      指南：
      - 为用户编写，而不是为开发者
      - 从最常见的用例开始
      - 包括可复制粘贴的代码示例
      - 记录所有配置选项及其默认值
      - 注意任何限制、边缘情况或陷阱
      - 链接到相关功能或规范

      示例结构：
      ```markdown
      ## Overview

      密码验证确保用户密码在帐户创建或密码更改之前符合安全要求。

      ## Getting Started

      导入并使用验证功能：

      ```typescript
      import { validatePassword } from './password';

      const result = validatePassword('MySecurePass1');
      if (!result.valid) {
        console.error(result.error);
      }
      ```

      ## Examples

      ### 基本验证
      ...

      ### 自定义错误处理
      ...

      ## Reference

      ### validatePassword(password)

      | 参数 | 类型 | 描述 |
      |-----------|------|-------------|
      | password | string | 要验证的密码 |

      **返回**：`{ valid: boolean, error?: string }`
      ```

      参考规范了解要求，参考实施了解详细信息。
