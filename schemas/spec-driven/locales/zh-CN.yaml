schema:
  description: 默认 OpenSpec 流程 - 提案 → 规格 → 设计 → 任务
artifacts:
  proposal:
    description: 概述变更的初始提案文档
    instruction: |
      创建提案文档，说明为什么需要这项变更。

      章节:
      - **为什么**: 1-2 句描述问题或机会。这解决了什么问题？为什么是现在？
      - **变更内容**: 变更清单。明确新能力、修改或移除项。破坏性变更用 **BREAKING** 标记。
      - **能力**: 指明将创建或修改哪些规格：
        - **新能力**: 列出新增能力。每项生成新的 `specs/<name>/spec.md`。使用 kebab-case 名称（例如 `user-auth`、`data-export`）。
        - **修改能力**: 列出现有能力中 REQUIREMENTS 发生变化的部分。仅当规格层面的行为改变（而非实现细节）才列出。每项都需要增量规格文件。请查看 `openspec/specs/` 中已有规格名称。若无需求变更请留空。
      - **影响**: 受影响的代码、API、依赖或系统。

      重要：Capabilities 部分至关重要，它建立了提案与规格阶段之间的契约。填写前请先研究现有规格。此处列出的每个能力都需要对应的规格文件。

      保持简洁（1-2 页）。聚焦“为什么”，而不是“怎么做”——实现细节应放在 design.md。

      这是基础——规格、设计和任务都以此为起点。

  specs:
    description: 变更的详细规格说明
    instruction: |
      创建定义系统“应该做什么”的规格文件。

      每个能力/功能领域对应一个 specs/<name>/spec.md 规格文件。

      增量操作（使用 ## 标题）：
      - **ADDED Requirements**: 新能力
      - **MODIFIED Requirements**: 行为改变 - MUST 包含完整更新内容
      - **REMOVED Requirements**: 弃用能力 - MUST 包含 **Reason** 与 **Migration**
      - **RENAMED Requirements**: 仅名称变化 - 使用 FROM:/TO: 格式

      格式要求：
      - 每条需求: `### Requirement: <name>` 后跟描述
      - 规范性需求使用 SHALL/MUST（避免 should/may）
      - 每个场景: `#### Scenario: <name>`，使用 WHEN/THEN 格式
      - **关键**: 场景必须使用恰好 4 个 # (`####`)。使用 3 个 # 或项目符号会导致静默失败。
      - 每条需求必须至少包含一个场景。

      MODIFIED 需求流程：
      1. 在 openspec/specs/<capability>/spec.md 中找到现有需求
      2. 复制完整需求块（从 `### Requirement:` 到所有场景）
      3. 粘贴到 `## MODIFIED Requirements` 下并修改为新的行为
      4. 确保标题文本完全一致（忽略空白）

      常见陷阱：使用 MODIFIED 但只提供部分内容会在归档时丢失细节。
      如果只是新增关注点而不改变既有行为，应使用 ADDED。

      示例：
      ```
      ## ADDED Requirements

      ### Requirement: 用户可以导出数据
      系统 MUST 允许用户以 CSV 格式导出其数据。

      #### Scenario: 导出成功
      - **WHEN** 用户点击“导出”按钮
      - **THEN** 系统下载包含所有用户数据的 CSV 文件

      ## REMOVED Requirements

      ### Requirement: 旧版导出
      **Reason**: 已被新的导出系统替代
      **Migration**: 使用新的导出端点 /api/v2/export
      ```

      规格应可测试——每个场景都是潜在测试用例。

  design:
    description: 包含实现细节的技术设计文档
    instruction: |
      创建说明“如何实现”变更的设计文档。

      需要 design.md 的情况（满足其一即可）：
      - 跨领域变更（多个服务/模块）或新的架构模式
      - 新外部依赖或显著的数据模型变更
      - 安全、性能或迁移复杂度
      - 在编码前需要技术决策来消除歧义

      章节：
      - **背景**: 背景、现状、约束、干系人
      - **目标 / 非目标**: 本设计要达成什么，以及明确不包含什么
      - **决策**: 关键技术选择及其原因（为什么选 X 而不是 Y）。每个决策需包含备选方案及理由。
      - **风险 / 权衡**: 已知限制、可能出问题的点。格式: [风险] → 缓解措施
      - **迁移计划**: 部署步骤、回滚策略（如适用）
      - **未决问题**: 仍待明确的决策或未知项

      聚焦架构与方案，不写逐行实现细节。
      参考提案的动机、规格的需求。

      好的设计文档应解释技术决策背后的“为什么”。

  tasks:
    description: 从规格与设计拆解的实现任务
    instruction: |
      创建将实现工作拆解为可执行步骤的任务清单。

      指引：
      - 使用编号的 ## 标题对相关任务分组
      - 每项任务是复选框: - [ ] X.Y 任务描述
      - 任务应足够小，能在一次会话内完成
      - 按依赖顺序排序（先做什么？）

      示例：
      ```
      ## 1. 准备

      - [ ] 1.1 创建新的模块结构
      - [ ] 1.2 在 package.json 中添加依赖

      ## 2. 核心实现

      - [ ] 2.1 实现数据导出函数
      - [ ] 2.2 添加 CSV 格式化工具
      ```

      参考规格明确“做什么”，参考设计明确“怎么做”。
      每个任务应可验证——你知道何时完成。
